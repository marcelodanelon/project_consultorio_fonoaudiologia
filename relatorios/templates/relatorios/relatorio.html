<!-- relatorio.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Relatório</title>
</head>
<body>
    <h1>Selecione os campos para o relatório</h1>
    <form method="post">
        {% csrf_token %}
        <h3>Campos de Agrupamento</h3>
        {{ form.campos_agrupamento.label_tag }}
        {% for campo in form.campos_agrupamento %}
            {{ campo }}
            {{ campo.label_tag }}
        {% endfor %}

        <h3>Campos Selecionados</h3>
        {{ form.campos.label_tag }}
        {% for campo in form.campos %}
            {{ campo }}
            {{ campo.label_tag }}
        {% endfor %}

        <h3>Filtros</h3>
        <div id="filtro_container">
            <div class="filtro-item">
                <label for="id_campo_filtro">Campo de Filtro:</label>
                {{ form.campo_filtro.label_tag }}
                <select name="campo_filtro" id="id_campo_filtro">
                    <option value="">-- Selecione um campo --</option>
                    {% for campo in form.campo_filtro.field.choices %}
                        <option value="{{ campo.0 }}">{{ campo.1 }}</option>
                    {% endfor %}
                </select>
                <input type="text" name="filtro_valor" placeholder="Digite o valor de filtro">
            </div>
        </div>
        <input type="button" id="add_filter" value="Adicionar Filtro">

        <input type="submit" value="Gerar Relatório">
    </form>

    {% if campos_agrupamento_selecionados %}
        <h3>Dados Agrupados</h3>
        {{campos_agrupamento_selecionados}}
    {% endif %}

    {% if campos_selecionados %}
        <h3>Dados Selecionados</h3>
        {{campos_selecionados}}
    {% endif %}

    {% if resultados %}
        <h3>Resultados</h3>
        {{resultados}}
    {% endif %}

    {% if dados_agrupados %}
        <h3>Dados Agrupados</h3>
        {{dados_agrupados | safe}}
    {% endif %}

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const addFilterButton = document.getElementById('add_filter');
        const filtroContainer = document.getElementById('filtro_container');

        addFilterButton.addEventListener('click', function() {
            const filterCount = filtroContainer.querySelectorAll('.filtro-item').length + 1;
            const newFilterField = document.createElement('div');
            newFilterField.className = 'filtro-item';
            newFilterField.innerHTML = `
                <label for="id_campo_filtro_${filterCount}">Campo de Filtro ${filterCount}:</label>
                <select name="campo_filtro_${filterCount}" id="id_campo_filtro_${filterCount}">
                    <option value="">-- Selecione um campo --</option>
                    {% for campo in form.campo_filtro.field.choices %}
                        <option value="{{ campo.0 }}">{{ campo.1 }}</option>
                    {% endfor %}
                </select>
                <input type="text" name="filtro_valor_${filterCount}" placeholder="Digite o valor de filtro">
            `;
            filtroContainer.appendChild(newFilterField);
        });
    });
    </script>
</body>
</html>